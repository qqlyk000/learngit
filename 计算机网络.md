# 计算机网络

## 计算机网络分层

#### 应用层

1. 所有能和用户交互产生网络流量的程序              
2. OSI参考模型的最高层
3. 典型服务(协议):
   - 文件传输(FTP)
   - 电子邮件(SMTP)
   - 万维网(HTTP)
4. 传输单元：报文

#### 表示层

1. 用于处理在两个通信系统中交换信息的表示方式(语法和语义)
   1. 功能一：数据格式变换	翻译官
   2. 功能二：数据加密解密    
   3. 数据的压缩和恢复
2. 主要协议：JPEG、ASCII

#### 会话层

1. 向表示层实体/用户进程提供建立连接并在连接上有序地传输数据。这是会话，也是建立同步(SYN)
   1. 功能一：建立、管理、终止会话
   2. 功能二：使用效验点可使会话在通信失效时从效验点/同步点进行恢复通信，实现数据同步。
   3. 适用传输带大文件
2. 主要协议：ADSP、ASP

#### 传输层

1. 负责主机中两个进程的通信，即端到端的通信。传输单位是报文段或用户数据报
   1. 功能一：可靠传输、不可靠传输
   2. 功能二：差错控制
   3. 功能三：流量控制
   4. 功能四：复用分用
      - 复用：多个应用层进程可同时使用下面运输层的服务
      - 分用：运输层把收到的信息分别交付给上面应用层中相应的进程
2. 主要协议：**TCP、UDP**
3. 传输单位：报文段

#### 网络层

1. 主要任务是把分组从源端传到目的端，为分组交换网上的不同主机提供通信服务。网络层传输单位是数据报。
   1. 功能一：路由选择	(最佳路径)
   2. 功能二：流量控制    
   3. 功能三：差错控制
   4. 功能四：拥塞控制
      - 若所有结点都来不及接受分组，而要丢弃大量分组的话，网络就处于**拥塞**状态。因此要采取一定措施缓解这种拥塞。
2. 主要协议：IP、IPX、ICMP、IGMP、ARP、RARP、OSPF
3. 传输单位：IP数据报，分组

详细：

1. 解决拥塞两种办法   
   - WAY1：开环控制        静
   - WAY2：闭环控制        动

#### 数据链路层

1. 主要任务是把网络层传下来的数据报组装成帧。
2. 数据链路层/链路层的传输单位是帧。
   1. 功能一：成帧（定义帧的开始和结束)
   2. 功能二：差错控制 **帧错+位错**
   3. 功能三：流量控制
   4. 功能四：访问（接入）控制  **控制对信道的访问**
3. 主要协议：SDLC、HDLC、PPP、STP
4. 传输单位：帧

#### 物理层

1. 主要任务是在**物理媒体**上实现比特流的**透明传输**。
   - **透明传输：**指不管所传数据是什么样的比特组合，都应当能够在链路上传送。
2. 物理层传输单位是**比特**。
   1. 功能一：定义接口特性
   2. 功能二：定义传输模式 **单工、半双工、双工。**
   3. 功能三：定义传输速率
   4. 功能四：比特同步
   5. 功能五：比特编码
3. 主要协议：Rj45、802.3
4. 传输单位：比特流

### OSI和TCP/IP

1. 相同点
   1. 都分层
   2. 基于独立的协议栈的概念
   3. 可以实现异构网络互联
2. 不同点
   1. OSI定义三点：服务、协议、接口
   2. OSI先出现，参考模型先于协议发明，不偏向特定协议
   3. TCP/IP设计之初就考虑到异构网互联问题，将IP作为重要层次
      - **面向连接**分为三个阶段，第一是建立连接，在此阶段，发出一个建立连接的请求。只有在连接成功建立之后，才能开始数据传输，这是第二阶段。接着，当数据传输完毕，必须释放连接。
      - 无连接没有这么多阶段，它直接进行数据传输。
      - ​                             ISO/OSI参考模型                                         TCP/IP模型
      - **网络层**                 **无连接+面向连接**                                             **无连接**
      - **传输层**                         **面向连接**                                            **无连接+面向连接**

### 奈氏准则 （内忧）

1. 理想条件下，极限码元传输速率为**2W Baud**,W是信道带宽，单位是**Hz**。
2. 理想低通信道下的极限数据传输率=2W*log2 V (b/s)

### 香农定理 （外患）

1. 信噪比=信号的平均功率/噪声的平均功率，常记为S/N，并用分贝（dB）作为度量单位。
   - 即： 信噪比（dB）=10*log10 (S/N)   数值等价
2. 在带宽受限且有噪音的信道中，为了不产生误差，信息的数据传输速率有上限值。
   - 信道的极限数据传输速率=W*log2 (1+S/N) （b/s)
3. 信道的带宽或信道中的信噪比越大，则信息的极限传输速率就越高。
4. 对一定的传输带宽和一定的信噪比，信息传输速率的上限就确定了。
5. 只要信息的传输速率低于信道的极限传输速率，就一定能找到某种方法来实现无差错的传输。
6. 香农定理得出的为极限信息传输速率，实际信道能达到的传输速率要比它低不少。

例：二进制信号在信噪比为127：1的4KHz信道上传输，最大的数据速率可达到多少？

- Nice:  2 * 4000 * log2 2 = 8000 b/s
- 香农:  4000 * log2 (1+127) = 28000 b/s
- 取小值，故最大速率为8000 b/s

#### 检错编码

1. 奇偶校验码
   1. 只能检查出奇数个比特错误，检错能力为50%
2. CRC循环冗余码
   - ​								发送端                                                                                        接收端
   - 要传的数据 / 生成多项式 = FCS帧检验序列/冗余码                       接收到的数据 %(mod) 生成多项式 = 0   (若余数为0，判定无错，就接受)
   - 计算冗余码
     1. 加0  假设生成多项式G(x)的阶为r，则加r个0。(多项式为N位，阶为N-1)
     2. 模2除法  数据加0后除以多项式，余数为冗余码/FCS      CRC检验码的比特序列
     3. ![image-20200801220938789](C:\Users\15744\AppData\Roaming\Typora\typora-user-images\image-20200801220938789.png)

#### 纠错编码

1. 海明码
   - 发现双比特错，纠正单比特错
   - 海明不等式：2^r - 1 >= k + r          r为冗余信息位，k为信息位
     - 要发送的数据：D=101101
     - 数据的位数k=6,满足不等式的最小r为4，也就是D=101101的海明码应该有6+4=10位，其中原数据6位，校验码4位。
   - 求出校验码的值
     - 令所有要校验的位异或=0 （看二进制与校验码相同的所有数）
     - 故101101的海明码为0010011101
   - 检错并纠错
     - 令所有要校验的位异或运算。

### 流量控制与可靠传输机制

1. 停止-等待协议   发送窗口大小=1，接收窗口大小=1；
2. 后退N帧协议(GBN)  发送窗口大小>1,接收窗口大小=1；
3. 选择重传协议(SR)  发送窗口大小>1,接收窗口大小>1; 

######  信道利用率

- 发送方在一个发送周期内，有效地发送数据所需要的时间占整个发送周期的比率
- 信道利用率 = （L / C）/ T     
  - L：T内发送L比特数据
  - C：发送方数据传输率
  - T：发送周期。从开始发送数据，到收到第一个确认帧为止
- 信道吞吐率 = 信道利用率 * 发送方的发送速率

###### 选择重传协议（SR）

1. SR协议重点总结
   1. 对数据帧逐一确认，收一个确认一个
   2. 只重传出错帧
   3. 接收方有缓存
   4. 滑动窗口长度：W(Tmax) = W(Rmax)=2^(n-1)   n：n个比特对帧编号

###### 后退N帧协议(GBN)

1. GBN协议重点
   1. 累计确认（偶尔捎带确认）
   2. 接收方只按顺序接收帧，不按序无情丢弃
   3. 确认序列号最大的、按序到达的帧
   4. 发送窗口最大为2^n - 1，接收窗口大小为1

##### 封装成帧和透明传输

1. **字符（节）填充法**
   - 填充转义字符
2. **零比特填充法**
   - **”5110“** ： 遇到5个1就填充一个0，在接收方遇到5个连续的1就把后面的0删除

### 介质访问控制

1. 静态划分信道
2. 动态划分信道                      **collision  detection       碰撞检测**
   1. 轮询访问介质访问控制
      - 既要不产生冲突，又要发送时占全部带宽
      - 令牌传递协议
   2. 随机访问介质访问控制         所有用户可随机发送信息。发送信息时占全部带宽
      1. ALOHA协议                **不听就说**
         1. 纯ALOHA协议  
            - 不监听信道，不按时间槽发送，随机发送。**想发就发**
         2. 时隙ALOHA协议
            - 把时间分成若干个相同的时间片，所有用户在事件片开始时刻同步接入网络信道，若发生冲突 ，则必须等到下一个时间片开始时刻再发送   **控制想发就发的随意性**
      2. CSMA协议                     **先听再说**
         - ​             1-坚持CSMA                            非坚持CSMA                             p-坚持CSMA
         - 信道空闲        马上发                             马上发                  p概率马上发，1-p概率等到下一个时隙发
         - 信道忙       继续坚持监听           放弃，等一个随机时间再监听      放弃，等一个随机时间再监听 
      3. **CSMA/CD协议**        **collision  detection   碰撞检测**           **先听再说，边听边说 **        
         1. **最小帧长**=总线传播时延 * 数据传输速率 * 2 = **2τ * 数据传输速率**
         2. 半双工网络                                  K = min[重传次数，10]
         3. 截断二进制指数规避算法             **重传最大次数16次**
      4. CSMA/CA协议         **collision avoidance    碰撞避免**  
         1. 预约信道
         2. ACK帧
         3. RTS帧/CTS帧（可选）
      5. CSMA/CD 与 CSMA/CA 
         1. 相同点：**先听再说**
         2. 不同点：
            1. 传输介质不同：CSMA/CD以太网【有线】，CSMA/CA无线局域网【无线】
            2. 载波检测方式不同
            3. CD检测冲突，CA避免冲突，二者出现冲突后都会进行有上限的重传

##### 广域网

1. PPP协议
   1. 点对点协议，只支持全双工链路
2. HDLC协议
3. 相同点：
   1. HDLC、PPP只支持全双工链路
   2. 都可以实现透明传输
   3. 都可以实现差错检测，但不纠正差错

###### 冲突域和广播域

1. 冲突域：在同一个冲突域中的每一个节点都能收到所有被发送的帧。简单的说就是同一时间内只能有一台设备发送信息的范围。
2. 广播域：网络中能接受任一设备发出的广播帧的所有设备的集合。简单的说如果站点发出一个广播信号，所有能接收收到这个信号的设备范围称为一个广播域。
   - ​                                            隔离冲突域                   隔离广播域
   - 物理层设备【傻瓜】                  X                                   X                     （中继器、集线器）
   - 链路层设备【路人】                  √                                   X                      （网桥、交换机）
   - 网络层设备【大佬】                  √                                   √                         （路由器）

###    网络层：

1. 数据交换方式

   1. 电路交换

      1. 特点：独占资源
      2. 优点
         1. 通信延时小
         2. 有序传输
         3. 没有冲突
         4. 实时性强
      3. 缺点
         1. 建立连接时间长
         2. 线路独占，使用效率低
         3. 灵活性差
         4. 无差错控制能力

   2. 报文交换            **串行**

      1. 优点
         1. 无需建立连接
         2. 存储转发，动态分配路线
         3. 线路可靠性较高
         4. 线路利用率较高
         5. 多目标服务
      2. 缺点
         1. 有存储转发时延
         2. 报文大小不定，需要网络节点有较大的缓存空间

   3. 分组交换          **并行**

      1. 优点：
         1. 无需建立连接
         2. 存储转发，动态分配路线
         3. 线路可靠性较高
         4. 线路利用率较高
         5. 相对于报文交换，存储管理更容易
      2. 缺点：
         1. 有存储转发时延
         2. 需要传输额外的信息量
         3. 乱序到目的主机时，要对分组排序重组

   4. 三种数据交换方式总结

      1. 报文交换和分组交换都采用存储转发
      2. 传送数据量大，且传送时间远大于呼叫时，选择电路交换。电路交换传输时延最小
      3. 从信道利用率看，报文交换和分组交换优于电路交换，其中分组交换时延更小。

      - 数据报方式
        1. 为网络层提供无连接服务
        2. 每个分组携带源和目的地址
        3. 路由器根据分组的目的地址转发分组
      - 虚电路方式
        1. 为网络层提供连接服务

###### 路由算法

1. 最佳路由：“最佳”只能是相对于某一种特定要求下得出的较为合理的选择而已。
2. 静态路由算法（非自适应路由算法）管理员手工配置路由信息
   1. 优点：简洁、可靠
   2. 缺点：路由更新慢，不适用大型网络
3. 动态路由算法（自适应路由算法）路由器间彼此交换信息，按照路由算法优化出路由表项。
   1. 优点：路由更新快，适用大型网络，及时响应链路费用或网络拓扑变化。
   2. 缺点：算法复杂，增加网络负担
   3. 全局性：链路状态路由算法    OSPF
      - 所有路由器掌握完整的网络拓扑和链路费用信息
   4. 分散性：距离向量路由算法     RIP
      - 路由器只掌握物理相连的邻居及链路费用

#### IPv4地址

1. 分类的IP地址
   1. A类（1~126）
      - 最大可用网络数  2^7 - 2     第一个可用网络号 1          最后一个可用网络号126    每个网络最大主机数2^24 - 2        
   2. B类（128~191）
      - 最大可用网络数  2^14 - 1     第一个可用网络号 128.1          最后一个可用网络号191.255    每个网络最大主机数2^16 - 2
   3. C类（192~223）
      - 最大可用网络数  2^21 - 1     第一个可用网络号 192.0.1          最后一个可用网络号223.255.255    每个网络最大主机数2^8 - 2
   4. D类（224~239）多播地址
   5. E类（240~255）保留为今后使用
2. 子网划分
   1. 子网掩码习题：已知IP地址是141.14.72.24 ，子网掩码是255.255.192.0，求网络地址
      - 72二进制为0100 1000                192二进制为1100 0000
      - 网络地址为：141.14.64.0              相与运算
   2. 路由器转发分组的算法：
      1. 提取目的IP地址
      2. 是否直接交付
      3. 特定主机路由
      4. 检测路由表中有无路径
      5. 默认路由0.0.0.0
      6. 丢弃，报告转发分组出错
3. 无分类编址CIDR
   1. 消除了传统的A类，B类和C类地址以及划分子网的概念。
   2. 融合子网地址与子网掩码，方便子网划分
   3. 构成超网
      1. 将多个子网聚合成一个较大的子网，叫做构成超网，或路由聚合。
      2. 方法：将网络前缀缩短
      3. 最长前缀匹配
   4. 习题：
      - 某网络的IP地址空间为192.168.5.0/24，采用定长子网划分，子网掩码为255.255.255.248，则该网络中的最大子网个数、每个子网内的最大可分配地址个数分别是（  B  ）
      - A.      32，8                 B.    32，6              C.    8，32                D.       8，30
4. ARP协议
   1. 由于在实际网络的链路上传送数据帧时，最终必须使用MAC地址
   2. ARP协议：完成主机或路由器IP地址到MAC地址的映射。**解决下一跳走哪的问题**
   3. 使用过程：检查ARP高速缓存，有对应表项则写入MAC帧，没有则用目的MAC地址为FF-FF-FF-FF-FF-FF的帧封装并广播ARP请求分组，同一局域网中所有主机都能收到该请求。目的主机收到请求后就会向源主机单播一个ARP响应分组，源主机收到后将此映射写入ARP缓存（10-20min更新一次）
   4. ARP协议4种典型情况：
      1. 主机A发给本网络上的主机B：用ARP找到主机B的硬件地址；
      2. 主机A发给另一网络上的主机B：用ARP找到本网络上一个路由器（网关）的硬件地址；
      3. 路由器发给本网络的主机A：用ARP找到主机A的硬件地址；
      4. 路由器发给另一网络的主机B：用ARP找到本网络上的一个路由器的硬件地址；
   5. ARP协议自动进行 
5. DHCP协议
   1. 动态主机配置协议DHCP是**应用层**协议，使用**客户/服务器**方式，客户端和服务端通过**广播**方式进行交互，基于**UDP**
   2. 流程：
      1. 主机广播**DHCP发现**报文
      2. DHCP服务器广播**DHCP提供**报文
      3. 主机广播**DHCP请求**报文
      4. DHCP服务器广播**DHCP确认**报文
6. ICMP协议
   1. ICMP协议支持主机或路由器：
      1. 差错（或异常）报告  发送特定ICMP报文
      2. ICMP差错报文
         1. 终点不可达         **无法交付**
         2. 源点抑制            **拥塞丢数据**
         3. 时间超过            **TTL=0**
         4. 参数问题          **首部字段有问题**
         5. 改变路由（重定向）          **值得更好的路由**
      3. ICMP询问报文
         1. 回送请求和回答报文  **测试目的站是否可达以及了解其相关状态。**
         2. 时间戳请求和回答报文     **用来进行时钟同步和测量时间**
      4. ICMP的应用
         1. PING 测试两个主机之间的连通性，使用了ICMP回送请求和回答报文
         2. Traceroute  跟踪一个分组从源点到终点的路径，使用了ICMP时间超过差错报告报文。

#### IPv6地址

1. IPv6和IPv4

   1. IPv6将地址从32位（4B）扩大到**128位（16B）**，更大的地址空间

   2. IPv6把校验和字段彻底移除，以减少每跳的处理时间。

   3. IPv6将IPv4的可选字段移出首部，变成了扩展首部，成为灵活的首部格式，路由器通常不对扩展首部进行检查，大大提高了路由器的处理效率。

   4. IPv6支持**即插即用**（即自动配置），不需要DHCP协议。

   5. IPv6首部长度必须是**8B的整数倍**，IPv4首部是4B的整数倍。

   6. **IPv6只能在主机出分片**，IPv4可以在路由器和主机处分片。

   7. ICMPv6：附加报文类型“分组过大”

      

 

